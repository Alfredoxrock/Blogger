<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>All Posts — Ink & Pages</title>
    <meta name="description" content="Browse all writing posts, stories, and craft notes on Ink & Pages." />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="styles/blog.css">
</head>

<body>
    <div class="wrap" id="app">
        <header>
            <div class="brand">
                <div class="logo">IP</div>
                <div>
                    <h1><a href="index.html" style="color: inherit; text-decoration: none;">Ink & Pages</a></h1>
                    <div class="muted">Short fiction, craft notes, and writing prompts</div>
                </div>
            </div>
            <nav class="nav">
                <a class="btn" href="index.html">Home</a>
                <a class="btn btn-primary" href="blog.html">All Posts</a>
                <a class="btn" href="categories.html">Categories</a>
                <a class="btn" href="about.html">About</a>
                <a class="btn" href="contact.html">Contact</a>
                <div class="search">
                    <input id="q" type="search" placeholder="Search posts..." aria-label="Search posts" />
                    <button class="btn" id="searchBtn">Search</button>
                </div>
                <a class="btn btn-primary" href="admin.html">Write</a>
            </nav>
        </header>

        <main>
            <section class="page-header">
                <h1>All Posts</h1>
                <p class="lead">Explore all stories, craft notes, and writing prompts.</p>

                <!-- Filter Controls -->
                <div class="filter-controls" style="margin-top: var(--spacing-md);">
                    <div class="filter-group">
                        <label for="categoryFilter">Filter by category:</label>
                        <select id="categoryFilter" class="filter-select">
                            <option value="">All Categories</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="sortBy">Sort by:</label>
                        <select id="sortBy" class="filter-select">
                            <option value="date-desc">Newest First</option>
                            <option value="date-asc">Oldest First</option>
                            <option value="title-asc">Title A-Z</option>
                            <option value="title-desc">Title Z-A</option>
                        </select>
                    </div>

                    <button class="btn" id="clearFilters">Clear Filters</button>
                </div>
            </section>

            <section class="posts-section">
                <div class="posts-meta">
                    <span>Showing <span id="count">0</span> posts</span>
                    <div class="view-toggle">
                        <button class="btn btn-small" id="gridView" title="Grid View">⊞</button>
                        <button class="btn btn-small" id="listView" title="List View">☰</button>
                    </div>
                </div>

                <div class="posts" id="posts"></div>

                <!-- Pagination -->
                <nav class="pagination" id="pagination" style="display: none;">
                    <button class="btn" id="prevPage">← Previous</button>
                    <div class="page-numbers" id="pageNumbers"></div>
                    <button class="btn" id="nextPage">Next →</button>
                </nav>

                <!-- Load More Button (alternative to pagination) -->
                <div class="load-more" id="loadMore"
                    style="display: none; text-align: center; margin-top: var(--spacing-lg);">
                    <button class="btn btn-primary" id="loadMoreBtn">Load More Posts</button>
                </div>
            </section>
        </main>

        <footer>
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Ink & Pages</h4>
                    <p>A personal corner for short fiction, craft reflections, and writing prompts.</p>
                    <div class="social-links">
                        <a href="#" class="btn">Twitter</a>
                        <a href="#" class="btn" onclick="blogManager.generateRSS()">RSS</a>
                        <a href="mailto:hello@inkandpages.com" class="btn">Email</a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Categories</h4>
                    <ul>
                        <li><a href="categories.html?cat=fiction">Fiction</a></li>
                        <li><a href="categories.html?cat=craft">Writing Craft</a></li>
                        <li><a href="categories.html?cat=prompts">Prompts</a></li>
                        <li><a href="categories.html?cat=essays">Essays</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="about.html">About</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="archive.html">Archive</a></li>
                        <li><a href="admin.html">Write</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Newsletter</h4>
                    <p>Get occasional writing notes and drafts</p>
                    <div class="subscribe">
                        <input id="email" type="email" placeholder="your@email.com" />
                        <button class="btn" id="subBtn">Subscribe</button>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Ink & Pages. Built with ✍️ by writers, for writers.</p>
            </div>
        </footer>
    </div>

    <!-- Single post overlay -->
    <div class="overlay" id="overlay">
        <div class="modal" role="dialog" aria-modal="true" aria-label="Post viewer">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:8px">
                <div>
                    <div id="modalTitle" style="font-size:18px; font-weight:700"></div>
                    <div id="modalMeta" class="meta"></div>
                </div>
                <div style="display:flex; gap:8px; align-items:center">
                    <button class="close" id="closeBtn">Close</button>
                </div>
            </div>
            <article id="modalBody" style="white-space:pre-wrap; color:#dfefff"></article>
        </div>
    </div>

    <script src="scripts/blog.js"></script>
    <script src="scripts/main.js"></script>
    <script>
        // Blog page specific functionality
        class BlogPageManager {
            constructor() {
                this.postsPerPage = 12;
                this.currentPage = 1;
                this.currentSort = 'date-desc';
                this.viewMode = 'grid'; // 'grid' or 'list'
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.populateFilters();
                this.initializeFromURL();
            }

            setupEventListeners() {
                // Filter controls
                document.getElementById('categoryFilter')?.addEventListener('change', (e) => {
                    blogManager.setCategoryFilter(e.target.value);
                    this.currentPage = 1;
                });

                document.getElementById('sortBy')?.addEventListener('change', (e) => {
                    this.currentSort = e.target.value;
                    this.applySorting();
                    this.currentPage = 1;
                });

                document.getElementById('clearFilters')?.addEventListener('click', () => {
                    this.clearAllFilters();
                });

                // View toggle
                document.getElementById('gridView')?.addEventListener('click', () => {
                    this.setViewMode('grid');
                });

                document.getElementById('listView')?.addEventListener('click', () => {
                    this.setViewMode('list');
                });

                // Pagination
                document.getElementById('prevPage')?.addEventListener('click', () => {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                        this.renderCurrentPage();
                    }
                });

                document.getElementById('nextPage')?.addEventListener('click', () => {
                    const totalPages = this.getTotalPages();
                    if (this.currentPage < totalPages) {
                        this.currentPage++;
                        this.renderCurrentPage();
                    }
                });

                // Load more
                document.getElementById('loadMoreBtn')?.addEventListener('click', () => {
                    this.loadMorePosts();
                });
            }

            populateFilters() {
                const categoryFilter = document.getElementById('categoryFilter');
                if (categoryFilter && blogManager) {
                    const categories = blogManager.getCategories();
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                        categoryFilter.appendChild(option);
                    });
                }
            }

            initializeFromURL() {
                const urlParams = new URLSearchParams(window.location.search);
                const category = urlParams.get('category');
                const search = urlParams.get('search');
                const page = urlParams.get('page');

                if (category) {
                    const categoryFilter = document.getElementById('categoryFilter');
                    if (categoryFilter) categoryFilter.value = category;
                    blogManager.setCategoryFilter(category);
                }

                if (search) {
                    const searchInput = document.getElementById('q');
                    if (searchInput) searchInput.value = search;
                    blogManager.currentFilter = search;
                }

                if (page) {
                    this.currentPage = parseInt(page) || 1;
                }

                this.renderCurrentPage();
            }

            applySorting() {
                if (!blogManager) return;

                const [field, direction] = this.currentSort.split('-');

                blogManager.posts.sort((a, b) => {
                    let comparison = 0;

                    if (field === 'date') {
                        comparison = (a.date || '').localeCompare(b.date || '');
                    } else if (field === 'title') {
                        comparison = (a.title || '').localeCompare(b.title || '');
                    }

                    return direction === 'desc' ? -comparison : comparison;
                });
            }

            setViewMode(mode) {
                this.viewMode = mode;
                const postsContainer = document.getElementById('posts');
                if (postsContainer) {
                    postsContainer.className = mode === 'list' ? 'posts posts-list' : 'posts';
                }

                // Update button states
                const gridBtn = document.getElementById('gridView');
                const listBtn = document.getElementById('listView');

                if (gridBtn && listBtn) {
                    gridBtn.classList.toggle('btn-primary', mode === 'grid');
                    listBtn.classList.toggle('btn-primary', mode === 'list');
                }
            }

            clearAllFilters() {
                blogManager.clearFilters();
                document.getElementById('categoryFilter').value = '';
                document.getElementById('sortBy').value = 'date-desc';
                this.currentSort = 'date-desc';
                this.currentPage = 1;
                this.updateURL();
            }

            getTotalPages() {
                if (!blogManager) return 1;
                const filteredPosts = blogManager.getFilteredPosts();
                return Math.ceil(filteredPosts.length / this.postsPerPage);
            }

            renderCurrentPage() {
                if (!blogManager) return;

                this.applySorting();
                const filteredPosts = blogManager.getFilteredPosts();
                const totalPages = Math.ceil(filteredPosts.length / this.postsPerPage);

                // Calculate pagination
                const startIndex = (this.currentPage - 1) * this.postsPerPage;
                const endIndex = startIndex + this.postsPerPage;
                const postsToShow = filteredPosts.slice(startIndex, endIndex);

                // Render posts
                const postsContainer = document.getElementById('posts');
                if (postsContainer) {
                    postsContainer.innerHTML = '';

                    if (postsToShow.length === 0) {
                        postsContainer.innerHTML = `
              <div class="post" style="text-align: center; color: var(--muted); grid-column: 1 / -1;">
                <h3>No posts found</h3>
                <p>Try adjusting your search terms or browse all posts.</p>
              </div>
            `;
                    } else {
                        postsToShow.forEach(post => {
                            const postCard = blogManager.createPostCard(post);
                            postsContainer.appendChild(postCard);
                        });
                    }
                }

                // Update pagination
                this.updatePagination(totalPages);

                // Update count
                blogManager.updatePostCount(filteredPosts.length);

                // Update URL
                this.updateURL();
            }

            updatePagination(totalPages) {
                const pagination = document.getElementById('pagination');
                const prevBtn = document.getElementById('prevPage');
                const nextBtn = document.getElementById('nextPage');
                const pageNumbers = document.getElementById('pageNumbers');

                if (!pagination || !prevBtn || !nextBtn || !pageNumbers) return;

                if (totalPages <= 1) {
                    pagination.style.display = 'none';
                    return;
                }

                pagination.style.display = 'flex';

                // Update prev/next buttons
                prevBtn.disabled = this.currentPage === 1;
                nextBtn.disabled = this.currentPage === totalPages;

                // Update page numbers
                pageNumbers.innerHTML = '';

                // Show up to 5 page numbers
                let startPage = Math.max(1, this.currentPage - 2);
                let endPage = Math.min(totalPages, startPage + 4);

                if (endPage - startPage < 4) {
                    startPage = Math.max(1, endPage - 4);
                }

                for (let i = startPage; i <= endPage; i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.className = `btn ${i === this.currentPage ? 'btn-primary' : ''}`;
                    pageBtn.textContent = i;
                    pageBtn.disabled = i === this.currentPage;
                    pageBtn.addEventListener('click', () => {
                        this.currentPage = i;
                        this.renderCurrentPage();
                    });
                    pageNumbers.appendChild(pageBtn);
                }
            }

            loadMorePosts() {
                // Alternative to pagination - loads more posts
                this.postsPerPage += 6;
                this.renderCurrentPage();
            }

            updateURL() {
                const params = new URLSearchParams();

                if (blogManager.currentCategory) {
                    params.set('category', blogManager.currentCategory);
                }

                if (blogManager.currentFilter) {
                    params.set('search', blogManager.currentFilter);
                }

                if (this.currentPage > 1) {
                    params.set('page', this.currentPage.toString());
                }

                const newURL = window.location.pathname + (params.toString() ? '?' + params.toString() : '');
                window.history.replaceState({}, '', newURL);
            }
        }

        // Initialize blog page manager when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Wait for blogManager to be ready
            setTimeout(() => {
                if (window.blogManager) {
                    window.blogPageManager = new BlogPageManager();
                }
            }, 100);
        });
    </script>
</body>

</html>